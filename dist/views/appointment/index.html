<div class="row">
  <div class="col-xs-12">
    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-building"></i> My Appointments
        </h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-12 col-sm-6 col-md-4">
            <h5>Search By:</h5>
            <form class="form">
              <div class="form-group">
                <label class="control-label" for="contractor">Contractor</label>
                <ui-select ng-model="filter['assignedContractor._id']" id="contractor" theme="bootstrap">
                  <ui-select-match placeholder="Contractor">
                    {{ $select.selected.data.name }}&lt;{{ $select.selected.data.email }}&gt;
                  </ui-select-match>
                  <ui-select-choices repeat="item._id as item in contractors | filter: $select.search" refresh="refreshContractors($select.search)" refresh-delay="250">
                    {{ item.data.name }}&lt;{{ item.data.email }}&gt;
                  </ui-select-choices>
                </ui-select>
              </div>
              <div class="form-group">
                <label class="control-label">Start Date</label>
                <p class="input-group">
                  <input type="text" class="form-control" uib-datepicker-popup="mediumDate" ng-model="startDate" min-date="minDate" max-date="endDate" is-open="startDatePopupOpen"/>
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="startDatePopupOpen = true"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                </p>
              </div>

              <div class="form-group">
                <label class="control-label">End Date</label>
                <p class="input-group">
                  <input type="text" class="form-control" uib-datepicker-popup="mediumDate" ng-model="endDate" min-date="startDate" is-open="endDatePopupOpen"/>
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="endDatePopupOpen = true"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                </p>
              </div>
              <div class="form-group">
                <button class="btn btn-default" ui-sref="appointmentIndex({filter: filter, startDate: startDate, endDate: endDate, time_filter: time_filter, time_startDate: time_startDate, time_endDate: time_endDate})" ui-sref-opts="{reload:true}">Search</button>
              </div>
            </form>
          </div>
        </div>
        <div ng-if="appointments.length == 0" class="alert alert-info" role="alert">
          Could not find any appointments. Click <strong>New Appointment</strong> to add one.
        </div>
        <div ng-if="appointments.length > 0">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Appointment Time</th>
                  <th>Address</th>
                  <th>Phone Number</th>
                  <th>Assigned Contractor</th>

                </tr>
              </thead>
              <tbody>
                <tr data-ng-repeat="appointment in appointments" class="clickable-table-row" ng-click="$state.go('appointment.view', {appointmentId: appointment._id})">
                  <td>{{ appointment.data.customer.data.lastName }}, {{ appointment.data.customer.data.firstName }}</td>
                  <td>{{ appointment.data.appointmentTime | date : 'medium' }}</td>
                  <td>{{ appointment.data.customer.data.address.formatted_address}}</td>
                  <td>{{ appointment.data.customer.data.phoneNumber}}</td>
                  <td>{{ appointment.data.assignedContractor.data.name }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <bgf-pagination collection="appointments" url="appointmentsUrl" url-params="urlParams" per-page="5" template-url="./views/pager.html"></bgf-pagination>
      </div>
      <div class="panel-footer">
        <a ui-sref="appointmentCreate()" class="btn btn-primary">
          <i class="glyphicon glyphicon-plus"></i> New Appointment
        </a>
      </div>
    </div>

    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-clock"></i> My Time
        </h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-xs-12 col-sm-6 col-md-4">
            <h5>Search By:</h5>
            <form class="form">
              <div class="form-group" ng-if="!isContractor">
                <label class="control-label" for="time_contractor">Contractor</label>
                <ui-select ng-model="time_filter['appointment.data.assignedContractor._id']" id="time_contractor" theme="bootstrap">
                  <ui-select-match placeholder="Contractor">
                    {{ $select.selected.data.name }}&lt;{{ $select.selected.data.email }}&gt;
                  </ui-select-match>
                  <ui-select-choices repeat="item._id as item in contractors | filter: $select.search" refresh="refreshContractors($select.search)" refresh-delay="250">
                    {{ item.data.name }}&lt;{{ item.data.email }}&gt;
                  </ui-select-choices>
                </ui-select>
              </div>
              <div class="form-group">
                <label class="control-label">Start Date</label>
                <p class="input-group">
                  <input type="text" class="form-control" uib-datepicker-popup="mediumDate" ng-model="time_startDate" max-date="time_endDate" is-open="time_startDatePopupOpen"/>
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="time_startDatePopupOpen = true"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                </p>
              </div>

              <div class="form-group">
                <label class="control-label">End Date</label>
                <p class="input-group">
                  <input type="text" class="form-control" uib-datepicker-popup="mediumDate" ng-model="time_endDate" min-date="time_startDate" is-open="time_endDatePopupOpen"/>
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="time_endDatePopupOpen = true"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                </p>
              </div>
              <div class="form-group">
                <button class="btn btn-default" ui-sref="appointmentIndex({filter: filter, startDate: startDate, endDate: endDate, time_filter: time_filter, time_startDate: time_startDate, time_endDate: time_endDate})" ui-sref-opts="{reload:true}">Search</button>
              </div>
            </form>
          </div>
        </div>
        <div ng-if="timeclocks.length == 0" class="alert alert-info" role="alert">
          Could not find any time entry. Click <strong>New Time Entry</strong> to add one.
        </div>
        <div ng-if="timeclocks.length > 0">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Activity</th>
                  <th ng-if="!isContractor">Contractor</th>
                  <th>Appointment</th>
                </tr>
              </thead>
              <tbody>
                <tr data-ng-repeat="time in timeclocks" class="clickable-table-row" ng-click="$state.go('timeclock.view', {timeclockId: time._id})">
                  <td>{{ time.data.time | date : 'medium' }}</td>
                  <td>{{ time.data.activity }}</td>
                  <td ng-if="!isContractor">{{ time.data.appointment.data.assignedContractor.data.name }}</td>
                  <td><a href="" ng-click="$state.go('appointment.view', {appointmentId: time.data.appointment._id}); $event.stopPropagation();">View Appointment</a></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <bgf-pagination collection="timeclocks" url="timeclocksUrl" url-params="time_urlParams" per-page="5" template-url="./views/pager.html"></bgf-pagination>
      </div>
      <div class="panel-footer">
        <a ui-sref="timeclockCreate()" class="btn btn-primary">
          <i class="glyphicon glyphicon-plus"></i> New Time Entry
        </a>
      </div>
    </div>
  </div>
</div>
